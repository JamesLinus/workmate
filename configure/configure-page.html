<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-input/paper-input.html">

<polymer-element name="configure-page">
  <template>
    <style>
    :host {
      font-family: sans-serif;
    }

    paper-button.blue {
      background: #4285f4;
      color: #fff;
    }

    paper-button.red {
      background: #e51c23;
      color: #fff;
    }

    paper-input {
      width: 100%;
    }
    </style>

    <template if="{{!data.google_oauth}}">
      <paper-button raised block class="blue" on-tap="{{signIn}}">
        Sign in
      </paper-button>
    </template>
    <template if="{{data.google_oauth}}">
      <paper-button raised block class="red" on-tap="{{signOut}}">
        Sign out
      </paper-button>
    </template>
    <br>
    <paper-button raised block class="blue" on-tap="{{save}}">Save</paper-button>
    <br>
    <paper-button raised block on-tap="{{refresh}}">Refresh</paper-button>
    <br>

    <paper-input
      floatingLabel
      multiline
      label="Debug data"
      value="{{data | toJSON}}"></paper-input>
  </template>

  <script>
  Polymer({
    data: null,

    created: function() {
      var hash = window.location.hash;
      if (hash) {
        this.data = JSON.parse(decodeURIComponent(hash.substring(1)));
      }
    },

    signIn: function() {
      window.location.href = 'https://keanulee.com/g/configure/google_oauth.php';
    },

    signOut: function() {
      this.data = {
        'google_oauth': null
      };
      this.save();
    },

    save: function() {
      window.location.href = 'pebblejs://close#' + encodeURIComponent(JSON.stringify(this.data));
    },

    refresh: function() {
      window.location.reload(true /* forcedReload */);
    },

    toJSON: {
      toDOM: function(value) {
        return JSON.stringify(value);
      },
      toModel: function(value) {
        return JSON.parse(value);
      }
    }
  });
  </script>
</polymer-element>